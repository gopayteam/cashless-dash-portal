<div class="parcels-container">
  <!-- ================= LOADING ================= -->
  <!-- <div class="loading-overlay" *ngIf="loading()">
    <p-progressSpinner style="width: 120px; height: 120px" strokeWidth="4" />
  </div> -->

  <!-- ================= HEADER ================= -->
  <div class="parcels-header">
    <div class="header-content">
      <h1>Parcel Source Stages</h1>
      <p class="text-muted">Daily parcel summary by source stage</p>
    </div>
  </div>

  <!-- ================= FILTER ================= -->
  <p-card styleClass="stat-card card filter-card">
    <div class="filters-grid">
      <div class="filter-group">
        <label class="filter-label">Date Range</label>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-date-range-input [rangePicker]="picker">
            <input matStartDate placeholder="Start date" [(ngModel)]="dateRange[0]" />
            <input matEndDate placeholder="End date" [(ngModel)]="dateRange[1]" />
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </div>

      <div class="filter-actions">
        <button pButton label="Apply" icon="pi pi-filter" (click)="applyFilters()"></button>
        <button
          pButton
          label="Reset"
          icon="pi pi-refresh"
          class="p-button-outlined"
          (click)="resetFilters()"
        ></button>
      </div>
    </div>
  </p-card>

  <!-- ================= TABLE ================= -->
  <p-card styleClass="stat-card card">
    <div class="table-header">
      <div class="table-header-left">
        <h3>Source Stages</h3>
        <span class="record-count">{{ totalRecords }} records</span>
      </div>
    </div>

    <p-table
      [value]="stages"
      [lazy]="true"
      [paginator]="true"
      [rows]="rows"
      [first]="first"
      [totalRecords]="totalRecords"
      [loading]="loading()"
      [rowsPerPageOptions]="[10, 20, 30, 50]"
      (onLazyLoad)="loadStages($event)"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first}â€“{last} of {totalRecords} sources"
      styleClass="data-table"
      [tableStyle]="{ 'min-width': '70rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Date</th>
          <th>Stage</th>
          <th>Parcels</th>
          <th>Cash</th>
          <th>Cashless</th>
          <th>Total Cost</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-stage>
        <tr>
          <td>{{ stage.parcelDate | date: 'dd MMM yyyy' }}</td>
          <td>
            <span class="badge badge-info">
              <i class="pi pi-map-marker"></i>
              {{ stage.stage }}
            </span>
          </td>
          <td>{{ stage.parcels }}</td>
          <td>Ksh {{ stage.cash | number: '1.2-2' }}</td>
          <td>Ksh {{ stage.cashless | number: '1.2-2' }}</td>
          <td class="amount-highlight">
            Ksh {{ stage.totalCost | number: '1.2-2' }}
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-map-marker"></i>
              <h3>No Data Found</h3>
              <p>Try adjusting the date range</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
