<!-- pages/dashboard/dashboard.component.html -->
<div class="dashboard-container">
  <!-- ================= GLOBAL LOADING OVERLAY ================= -->
  <!-- Using global .loading-overlay class -->
  <!-- <div class="loading-overlay" *ngIf="loading()">
    <p-progressSpinner style="width: 120px; height: 120px" strokeWidth="4" />
  </div> -->



  <!-- ================= HEADER ================= -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Dashboard Overview</h1>
      <p class="text-muted">Welcome back! Here's what's happening with your fleet today.</p>
    </div>

    <div class="filter-item-gradient filter-item">
      <label class="filter-label">Select Date Range</label>
      <mat-form-field appearance="outline" class="date-range-field">
        <mat-date-range-input [rangePicker]="picker">
          <input matStartDate placeholder="Start date" [(ngModel)]="dateRange[0]" />
          <input matEndDate placeholder="End date" [(ngModel)]="dateRange[1]" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker (closed)="onDateRangeChange()"></mat-date-range-picker>
      </mat-form-field>
    </div>
  </div>

  <!-- ================= STATS CARDS ================= -->
  <!-- Using global .stat-card class with hover effect -->
  <div class="stats-grid">
    <p-card *ngFor="let card of statsCards" styleClass="stat-card card-hover">
      <!-- Using global .stat-content class -->
      <div class="stat-content">
        <div class="stat-info">
          <!-- Using global .stat-title class -->
          <span class="stat-title">{{ card.title }}</span>

          <!-- Using global .stat-value class -->
          <h2 class="stat-value">
            <ng-container *ngIf="card.amount !== undefined; else countValue">
              <span class="currency">{{ card.currency }}</span>
              <span class="amount">
                {{ card.amount | number : '1.0-2' }}
              </span>
            </ng-container>

            <ng-template #countValue>
              <span class="amount">
                {{ card.count | number }}
              </span>
            </ng-template>
          </h2>

          <!-- Using global .stat-change class -->
          <span class="stat-change positive" *ngIf="card.change">
            <i class="pi pi-arrow-up"></i> {{ card.change }}
          </span>
        </div>

        <!-- Using global .stat-icon class -->
        <div class="stat-icon" [style.background-color]="card.color + '20'">
          <i [class]="'pi ' + card.icon" [style.color]="card.color"></i>
        </div>
      </div>
    </p-card>
  </div>

  <!-- ================= CHARTS SECTION ================= -->
  <div class="charts-grid">
    <!-- Line Chart -->
    <!-- Using global .card class -->
    <p-card header="Organizations Performance" styleClass="stat-card card">
      <div class="chart-container">
        <p-chart
          *ngIf="chartData"
          type="line"
          [data]="chartData"
          [options]="chartOptions"
          height="300px"
        ></p-chart>
      </div>
    </p-card>

    <!-- Pie Chart -->
    <p-card header="Total Amount Per Category" styleClass="stat-card card">
      <div class="chart-container">
        <p-chart
          *ngIf="pieChartData"
          type="pie"
          [data]="pieChartData"
          [options]="pieChartOptions"
          height="300px"
        ></p-chart>
      </div>

      <!-- Dynamic Legend -->
      <div class="category-legend" *ngIf="pieChartData">
        <div class="legend-item" *ngFor="let label of pieChartData.labels; let i = index">
          <span
            class="legend-dot"
            [style.background]="pieChartData.datasets[0].backgroundColor[i]"
          ></span>
          <span class="legend-label">{{ label }}</span>
          <span class="legend-value">
            Ksh {{ pieChartData.datasets[0].data[i] | number : '1.2-2' }}
          </span>
        </div>
      </div>
    </p-card>
  </div>

  <!-- ================= RECENT TRANSACTIONS ================= -->
  <p-card header="Recent Transactions" styleClass="stat-card card">
    <!-- Using global .data-table class -->
    <p-table
      [value]="recentTransactions"
      [lazy]="true"
      [paginator]="true"
      [rows]="rows"
      [first]="first"
      [loading]="loading()"
      [totalRecords]="totalRecords"
      [rowsPerPageOptions]="[5, 10, 20, 30, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first}â€“{last} of {totalRecords}"
      (onLazyLoad)="loadTransactions($event)"
      styleClass="data-table"
      [tableStyle]="{ 'min-width': '60rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Transaction ID</th>
          <th>Date</th>
          <th>Time</th>
          <th>Vehicle</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Status</th>
          <!-- <th>Actions</th> -->
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-transaction>
        <tr>
          <td>{{ transaction.mpesaReceiptNumber }}</td>
          <td>{{ transaction.createdAt | date : 'dd MMM yyyy, hh:mm a' }}</td>
          <td>{{ transaction.createdAtFormatted || "N/A" }}</td>
          <td>
            <!-- Using component-specific .vehicle-badge -->
            <span class="vehicle-badge">
              <i class="pi pi-car"></i>
              {{ transaction.fleetNumber }}
            </span>
          </td>
          <td class="amount-cell">Ksh {{ transaction.assignedAmount | number : '1.2-2' }}</td>
          <td>
            <!-- Using global .badge classes -->
            <span [class]="'badge badge-' + transaction.transactionType.toLowerCase()">
              {{ transaction.transactionType }}
            </span>
          </td>
          <td>
            <!-- Using global .badge classes -->
            <span [class]="'badge badge-' + transaction.paymentStatus.toLowerCase()">
              {{ transaction.paymentStatus }}
            </span>
          </td>
          <!-- <td>
            <button
              pButton
              icon="pi pi-eye"
              class="p-button-rounded p-button-text p-button-sm"
              pTooltip="View Details"
              tooltipPosition="top"
            ></button>
          </td> -->
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
